---
- name: Deploy Grocy

  hosts: grocy

  vars:

    # Grocy service facts
    grocy_image_name: linuxserver/grocy
    grocy_image_tag: 4.4.1
    grocy_service_name: grocy
    grocy_service_port: 9283
    grocy_volume_name: grocy

  tasks:

    - name: Load homelab vars
      ansible.builtin.include_vars:
        file: vars/homelab_env.yaml

    - name: Deploy a containerised instance of Grocy
      ansible.builtin.include_tasks:
        file: tasks/deploy-grocy.yaml

    - name: Deploy a containerised instance of Docker Volume Backup
      ansible.builtin.include_tasks:
        file: tasks/deploy-docker-volume-backup.yaml
      vars:
        docker_volume_backup_volume_to_backup:
          - "{{ grocy_volume_name }}:/backup/grocy-backup:ro"

    - name: Deploy Duplicati
      ansible.builtin.include_tasks:
        file: tasks/deploy-duplicati.yaml
